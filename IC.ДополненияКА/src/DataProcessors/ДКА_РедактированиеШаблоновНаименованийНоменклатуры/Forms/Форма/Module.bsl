//
//	Филимонов И.В.
//		+7 913 240 81 77
//		+7 905 084 20 06 (Telegram)
//		https://github.com/Shu-ler
//		

// @strict-types
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	// Возврат при получении формы для анализа
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;

	// Вызов стандартной для конфигунации обработки события
	ДКА_СобытияФорм.ПриСозданииНаСервере(ЭтотОбъект, Отказ, СтандартнаяОбработка);

КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ВыполнитьЗамену(Команда)

	// Настройка поведения формы при выполнении длительной операции
	ПараметрыОжидания = ДлительныеОперацииКлиент.ПараметрыОжидания(ЭтотОбъект);
	ПараметрыОжидания.ВыводитьОкноОжидания = Истина;
	ПараметрыОжидания.ВыводитьПрогрессВыполнения = Истина;
	ПараметрыОжидания.ВыводитьСообщения = Истина;
	ПараметрыОжидания.Интервал = 2;
	ПараметрыОжидания.ОповещениеПользователя.Показать = Истина;
	ПараметрыОжидания.ОповещениеПользователя.Текст = НСтр("ru= 'Обновление шаблонов наименований завершено'");

	// Подготовка аргументов для серверного вызова
	Аргументы = Новый Структура;
	Аргументы.Вставить("ИскомыйТекст", ИскомыйТекст);
	Аргументы.Вставить("Замена", Замена);
	Аргументы.Вставить("Свойство", Свойство);
	Аргументы.Вставить("ТипНаименования", ТипНаименования);
	Аргументы.Вставить("УникальныйИдентификатор", УникальныйИдентификатор);
	
	// Задание методов для выполнения длительной операции
	ФоновоеЗадание = НачатьИзменениеШаблоновНаименований(Аргументы);
	МетодЗавершения = Новый ОписаниеОповещения("ЗавершитьИзменениеШаблоновНаименований", ЭтотОбъект);
	
	// Запуск выполнения
	ДлительныеОперацииКлиент.ОжидатьЗавершение(ФоновоеЗадание, МетодЗавершения, ПараметрыОжидания);

КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Начать изменение шаблонов наименований.
// 
// Параметры:
//  Аргументы - см. ДКА_РедактированиеШаблоновНаименований.ИзменениеШаблоновНаименований
// 
// Возвращаемое значение:
//  Структура - Начать изменение шаблонов наименований:
// * Статус - Строка -
// * ИдентификаторЗадания - УникальныйИдентификатор -
// * АдресРезультата - Строка -
// * КраткоеПредставлениеОшибки - Строка -
// * ПодробноеПредставлениеОшибки - Строка -
// * Сообщения - ФиксированныйМассив из Строка -
&НаСервереБезКонтекста
Функция НачатьИзменениеШаблоновНаименований(Аргументы)

	ИмяФункции = "ДКА_РедактированиеШаблоновНаименований.ИзменениеШаблоновНаименований";
	ПараметрыВыполнения = ДлительныеОперации.ПараметрыВыполненияФункции(Аргументы.УникальныйИдентификатор);

	Возврат ДлительныеОперации.ВыполнитьФункцию(ПараметрыВыполнения, ИмяФункции, Аргументы);

КонецФункции

// Завершить изменение шаблонов наименований.
// 
// Параметры:
//  Результат - Структура - Результат:
//  * АдресРезультата - Строка
//  ДополнительныеПараметры - Структура - Дополнительные параметры
&НаКлиенте
Процедура ЗавершитьИзменениеШаблоновНаименований(Результат, ДополнительныеПараметры) Экспорт

	Если ТипЗнч(Результат) = Тип("Структура") Тогда
	
		Нечто = ПолучитьИзВременногоХранилища(Результат.АдресРезультата);
		
	КонецЕсли;

КонецПроцедуры

#КонецОбласти